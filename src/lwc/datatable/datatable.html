<template>
    <div class="datatable" data-is-desktop={isDesktop} data-is-phone={isPhone} data-is-tablet={isTablet}>
        <div class="header">
            <div>
                <template if:true={table.title}>
                    <h1>{table.title}</h1>
                </template>
                <template if:true={table.description}>
                    <p>{table.description}</p>
                </template>
            </div>
            <template if:false={showDetailModal}>
                <template if:true={hasSearchables}>
                    <div class="search-element" >
                        <input class="searchInput" placeholder={GeneralSearch} type="search" value={searchTerm} onkeyup={setSearchTerm} onsearch={searchEvent} onfocus={focusFilter} onblur={searchEventOnBlur}/>
                        <div class="icons-group">
                            <template if:true={showCancelSearch}>
                                <template if:false={isDesktop}>
                                    <button class="cancelSearch" onclick={cancelFilter}>{GeneralCancel}</button>
                                </template>
                                <template if:true={isDesktop}>
                                    <img src={closeIcon}  onclick={cancelFilter}> 
                                </template>
                            </template>
                            <template if:true={showFilterIcon}>
                                <img class="filterIcon" src={filterIcon} onclick={openFilterModal}>
                            </template>
                        </div>
                    </div>
                </template>
            </template>
        </div>
            
        <template if:false={showDetailModal}>
            <template if:true={hasFilters}>
                <!-- Desktop filters -->
                <template if:false={isPhone}>
                        <c-datatable-modals  type="filterModal"
                            table={table} 
                            rowkey={clickRow}
                            rowaction={rowAction}
                            closeicon={closeIcon}
                            onclose={closeFilterModal}
                            is-desktop={isDesktop}
                            isphone={isPhone}
                            appliedfilters={appliedFilters}
                            >
                        </c-datatable-modals>  
                </template>
            </template>
        </template>

        <template if:true={isPhone}>
            <template if:true={appliedFilters}>
                <div class="applied-filter-container">
                    <template for:each={table.appliedFilters} for:item="filters">
                        <div class="pills-container" key={filters.value1}>
                            <span class="slds-pill" >
                                <template if:true={filters.label}>
                                    <span class="slds-pill__label">{filters.label}</span>
                                </template>
                                <template if:false={filters.label}>
                                    <span class="slds-pill__label">{filters.value1}</span>
                                </template>
                                <img src={closeIcon} data-name={filters.filter.name} data-value={filters.value1} onclick={deleteFilter}>
                            </span>
                        </div>
                    </template>
                </div>
            </template>
        </template>
        
        <template if:true={isDesktop}>
            <!---->
            <template if:false={hideTable}>
                <table class="slds-table slds-table_cell-buffer slds-no-row-hover desktop-table">
                    <thead>
                        <tr>
                            <template for:each={columnsToShow} for:item="col">
                                <th scope="col" key={col.label}>
                                    <template if:true={col.sortable}>
                                        <div class="slds-truncate columnLabel" title={col.label} data-field-name={col.fieldName} data-direction="ASC"  onclick={sortByColumn}> 
                                            <c-datatable-row colname={col.label} is-desktop={isDesktop} hide-values column={col.fieldName} row={row}></c-datatable-row>                                    
                                            <img class="sortIcon" src={sortIcon}>
                                        </div>
                                    </template> 
                                    <template if:false={col.sortable}>
                                        <div class="slds-truncate columnLabel" title={col.label}> 
                                            <c-datatable-row colname={col.label} is-desktop={isDesktop} hide-values column={col.fieldName} row={row}></c-datatable-row>                                    
                                        </div>
                                    </template>
                                </th>
                            </template>
                        </tr>
                    </thead>
                    <tbody>
                        <template for:each={table.tableData} for:item="row">
                            <tr class="slds-hint-parent" key={row.Id} data-key={row.Id} >
                                <template for:each={columnsToShow} for:item="col">
                                    <td data-label={col.label} key={col.label} data-key={row.Id} onclick={openDetailModal}>
                                        <div>
                                            <c-datatable-row colname={col.label} is-desktop hide-columns column={col.fieldName} row={row}></c-datatable-row>
                                        </div> 
                                    </td>
                                </template>
                                
                                <template if:true={hasRowActions}>
                                    <td class="extraRowActionContainer">
                                        <div class="slds-grid slds-gutters full-list">
                                                
                                            <template for:each={rowAction} for:item="action">
                                                <div key={action.label} class="actions-visualization">
                                                    {action.label}
                                                    <img src={action.icon}
                                                        data-id={row.Id}
                                                        data-component={action.component}
                                                        data-modal={action.showAsModal}
                                                        data-navigation={action.navigation}
                                                        onclick={rowActionEvent}>
                                                </div>
                                            </template>
                                            <div onclick={showMoreRowActions} class="trigger">
                                                <img src={arrowIcon}/>
                                            </div>
                                        </div>

                                        <div class="trigger">
                                            <template for:each={firstLevelRowAction} for:item="action">
                                                <div key={action.label}>
                                                    <img src={action.icon}
                                                        data-id={row.Id}
                                                        data-component={action.component}
                                                        data-modal={action.showAsModal}
                                                        data-navigation={action.navigation}
                                                        onclick={rowActionEvent}>
                                                </div>
                                            </template>
                                            <template if:true={hasExtraRowActions}>
                                                <div onclick={showMoreRowActions}>
                                                    <img src={moreIcon}/>
                                                </div>
                                            </template>
                                        </div>
                                    </td>


                                </template>
                            </tr>
                        </template>
                        <template if:true={noRecordsToDisplay}>
                            <tr>
                               <td colspan="100%">
                                   <p class="no-records-to-display">{table.noRecordsMsg}</p>
                               </td> 
                            </tr>
                        </template>
                        <template if:false={noRecordsToDisplay}>
                            <template if:true={hasMore}>
                                <tr class="pagination" onclick={getPage}>
                                    <td colspan="100%">
                                        <div>
                                            {GeneralShowMore}
                                        </div> 
                                    </td>
                                </tr>
                            </template>
                        </template>
                    </tbody>
                </table>
            </template>
        </template>

        <template if:false={isDesktop}>
            <div class="cards-container">
                <template for:each={table.tableData} for:item="row">    
                    <article key={row.Id} class="slds-card">   
                        <div class="slds-grid slds-wrap" onclick={openDetailModal} data-key={row.Id}>
                            <template for:each={columnsToShow} for:item="col">
                                <div key={col.label} class={columnClass}>
                                    <c-datatable-row colname={col.label} column={col.fieldName} row={row}></c-datatable-row>
                                </div> 
                            </template>
                        </div>
                        <footer class="slds-card__footer slds-grid slds-wrap">
                            <template for:each={firstLevelRowAction} for:item="action">
                                    <div key={action.label} class="slds-no-flex slds-col slds-size_1-of-4">
                                        <img src={action.icon} 
                                            data-id={row.Id} 
                                            data-component={action.component} 
                                            data-modal={action.showAsModal}
                                            data-navigation={action.navigation} 
                                            onclick={rowActionEvent}>
                                    </div>
                            </template> 
                            <div class="slds-no-flex slds-col slds-size_1-of-4">
                                <img src={moreIcon} onclick={openActionModal}>
                            </div>
                        </footer>
                    </article>
                </template>
            </div>
        </template>
        <!-- <template if:true={appliedFilters}>
            <div class="table__footer">
                <button class="remove-filter-btn" onclick={filterAllRemove}>{RemoveAllFilters}</button>
            </div>
        </template> -->
        <!--                MODALS                 -->

        <!-- Mobile filters -->
        <template if:true={isPhone}>
            <template if:true={showFilterModal}>
                <c-datatable-modals  type="filterModal"
                                        table={table} 
                                        rowkey={clickRow}
                                        rowaction={rowAction}
                                        closeicon={closeIcon}
                                        onclose={closeFilterModal}
                                        is-desktop={isDesktop}
                                        isphone={isPhone}>
                </c-datatable-modals>
            </template>
        </template>

        <template if:true={showDetailModal}>
            <c-datatable-modals  type="detailModal"
                                    table={table} 
                                    rowkey={clickRow}
                                    rowaction={rowAction}
                                    closeicon={closeIcon}
                                    onclose={closeDetailModal}
                                    is-desktop={isDesktop}
                                    isphone={isPhone}>
            </c-datatable-modals>
        </template>
        <template if:true={showActionModal}>
            <c-datatable-modals  type="actionModal"
                                    table={table} 
                                    rowaction={rowAction}
                                    rowkey={clickRow}
                                    closeicon={closeIcon}
                                    onclose={closeActionModal}
                                    is-desktop={isDesktop}
                                    isphone={isPhone}>
            </c-datatable-modals>
        </template>
    </div>
</template>